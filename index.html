<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شجرة العائلة</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .app-content {
            display: flex;
            min-height: 600px;
        }
        
        .sidebar {
            width: 300px;
            background-color: #f8f9fa;
            padding: 20px;
            border-left: 1px solid #e9ecef;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            position: relative;
            overflow: auto;
        }
        
        .control-panel {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        button {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        button.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        button.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .family-tree {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            min-height: 500px;
            position: relative;
            overflow: auto;
        }
        
        .tree-container {
            position: relative;
            min-height: 400px;
            margin: 20px 0;
        }
        
        .person {
            position: absolute;
            width: 120px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .person:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 20;
        }
        
        .person.male {
            border-top: 4px solid #4b6cb7;
        }
        
        .person.female {
            border-top: 4px solid #e83e8c;
        }
        
        .person-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .person-dates {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .connector {
            position: absolute;
            background-color: #6c757d;
            z-index: 1;
        }
        
        .connector.horizontal {
            height: 2px;
        }
        
        .connector.vertical {
            width: 2px;
        }
        
        .instructions {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        .instructions ul {
            padding-right: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #495057;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .person-options {
            position: absolute;
            background: white;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 100;
            padding: 5px 0;
        }
        
        .option {
            padding: 8px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .option:hover {
            background-color: #f8f9fa;
        }
        
        @media (max-width: 768px) {
            .app-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-left: none;
                border-bottom: 1px solid #e9ecef;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>شجرة العائلة</h1>
            <p class="subtitle">أنشئ شجرة عائلتك بسهولة وبدون تعقيد</p>
        </header>
        
        <div class="app-content">
            <div class="main-content">
                <div class="control-panel">
                    <button id="addPersonBtn">إضافة فرد</button>
                    <button id="saveTreeBtn" class="success">حفظ الشجرة</button>
                    <button id="loadTreeBtn" class="secondary">تحميل الشجرة</button>
                    <button id="resetTreeBtn" class="danger">بدء من جديد</button>
                </div>
                
                <div class="family-tree">
                    <h2>شجرة العائلة</h2>
                    <div class="tree-container" id="treeContainer">
                        <!-- سيتم إضافة عناصر الشجرة هنا ديناميكيًا -->
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="instructions">
                    <h3>كيفية الاستخدام:</h3>
                    <ul>
                        <li>انقر على "إضافة فرد" لإضافة فرد جديد للشجرة</li>
                        <li>املأ البيانات المطلوبة في النموذج</li>
                        <li>اسحب الأفراد لوضعهم في المكان المناسب</li>
                        <li>انقر على فرد لعرض خيارات التعديل أو الحذف</li>
                        <li>احفظ شجرتك لاستعادتها لاحقًا</li>
                    </ul>
                </div>
                
                <div class="instructions">
                    <h3>نصائح:</h3>
                    <ul>
                        <li>ابدأ بإضافة الجد الأكبر في الأعلى</li>
                        <li>أضف الأبناء تحت الآباء مباشرة</li>
                        <li>استخدم الألوان للتمييز بين الذكور والإناث</li>
                        <li>يمكنك إضافة صور للأفراد لتعزيز الشجرة</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- نموذج إضافة فرد -->
    <div class="modal" id="personModal">
        <div class="modal-content">
            <h2 id="modalTitle">إضافة فرد جديد</h2>
            <form id="personForm">
                <div class="form-group">
                    <label for="personName">الاسم الكامل:</label>
                    <input type="text" id="personName" required>
                </div>
                
                <div class="form-group">
                    <label for="personGender">الجنس:</label>
                    <select id="personGender" required>
                        <option value="male">ذكر</option>
                        <option value="female">أنثى</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="birthDate">تاريخ الميلاد:</label>
                    <input type="date" id="birthDate">
                </div>
                
                <div class="form-group">
                    <label for="deathDate">تاريخ الوفاة (إن وجد):</label>
                    <input type="date" id="deathDate">
                </div>
                
                <div class="form-group">
                    <label for="personNotes">ملاحظات:</label>
                    <input type="text" id="personNotes" placeholder="معلومات إضافية عن الفرد">
                </div>
                
                <div class="modal-buttons">
                    <button type="button" id="cancelBtn" class="secondary">إلغاء</button>
                    <button type="submit" id="savePersonBtn" class="success">حفظ</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- نموذج تأكيد الحذف -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h2>تأكيد الحذف</h2>
            <p>هل أنت متأكد من رغبتك في حذف هذا الفرد؟</p>
            <div class="modal-buttons">
                <button id="cancelDelete" class="secondary">إلغاء</button>
                <button id="confirmDelete" class="danger">حذف</button>
            </div>
        </div>
    </div>

    <script>
        // بيانات التطبيق
        let familyTree = [];
        let editingPersonId = null;
        let selectedPersonId = null;
        
        // العناصر الأساسية في DOM
        const treeContainer = document.getElementById('treeContainer');
        const personModal = document.getElementById('personModal');
        const confirmModal = document.getElementById('confirmModal');
        const personForm = document.getElementById('personForm');
        const modalTitle = document.getElementById('modalTitle');
        
        // الأزرار
        const addPersonBtn = document.getElementById('addPersonBtn');
        const saveTreeBtn = document.getElementById('saveTreeBtn');
        const loadTreeBtn = document.getElementById('loadTreeBtn');
        const resetTreeBtn = document.getElementById('resetTreeBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const savePersonBtn = document.getElementById('savePersonBtn');
        const cancelDelete = document.getElementById('cancelDelete');
        const confirmDelete = document.getElementById('confirmDelete');
        
        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // تحميل شجرة العائلة من التخزين المحلي إن وجدت
            loadTreeFromStorage();
            
            // إضافة مستمعي الأحداث
            addPersonBtn.addEventListener('click', openAddPersonModal);
            saveTreeBtn.addEventListener('click', saveTreeToStorage);
            loadTreeBtn.addEventListener('click', loadTreeFromStorage);
            resetTreeBtn.addEventListener('click', resetTree);
            cancelBtn.addEventListener('click', closePersonModal);
            personForm.addEventListener('submit', savePerson);
            cancelDelete.addEventListener('click', closeConfirmModal);
            confirmDelete.addEventListener('click', deletePerson);
            
            // إغلاق النماذج عند النقر خارجها
            window.addEventListener('click', function(event) {
                if (event.target === personModal) {
                    closePersonModal();
                }
                if (event.target === confirmModal) {
                    closeConfirmModal();
                }
            });
            
            // عرض شجرة العائلة
            renderFamilyTree();
        });
        
        // فتح نموذج إضافة فرد
        function openAddPersonModal() {
            editingPersonId = null;
            modalTitle.textContent = 'إضافة فرد جديد';
            personForm.reset();
            personModal.style.display = 'flex';
        }
        
        // فتح نموذج تعديل فرد
        function openEditPersonModal(personId) {
            const person = familyTree.find(p => p.id === personId);
            if (!person) return;
            
            editingPersonId = personId;
            modalTitle.textContent = 'تعديل بيانات الفرد';
            
            document.getElementById('personName').value = person.name;
            document.getElementById('personGender').value = person.gender;
            document.getElementById('birthDate').value = person.birthDate || '';
            document.getElementById('deathDate').value = person.deathDate || '';
            document.getElementById('personNotes').value = person.notes || '';
            
            personModal.style.display = 'flex';
        }
        
        // إغلاق نموذج الفرد
        function closePersonModal() {
            personModal.style.display = 'none';
        }
        
        // فتح نموذج تأكيد الحذف
        function openConfirmModal(personId) {
            selectedPersonId = personId;
            confirmModal.style.display = 'flex';
        }
        
        // إغلاق نموذج تأكيد الحذف
        function closeConfirmModal() {
            confirmModal.style.display = 'none';
        }
        
        // حفظ بيانات الفرد
        function savePerson(e) {
            e.preventDefault();
            
            const name = document.getElementById('personName').value;
            const gender = document.getElementById('personGender').value;
            const birthDate = document.getElementById('birthDate').value;
            const deathDate = document.getElementById('deathDate').value;
            const notes = document.getElementById('personNotes').value;
            
            if (editingPersonId) {
                // تعديل فرد موجود
                const personIndex = familyTree.findIndex(p => p.id === editingPersonId);
                if (personIndex !== -1) {
                    familyTree[personIndex].name = name;
                    familyTree[personIndex].gender = gender;
                    familyTree[personIndex].birthDate = birthDate;
                    familyTree[personIndex].deathDate = deathDate;
                    familyTree[personIndex].notes = notes;
                }
            } else {
                // إضافة فرد جديد
                const newPerson = {
                    id: Date.now().toString(),
                    name: name,
                    gender: gender,
                    birthDate: birthDate,
                    deathDate: deathDate,
                    notes: notes,
                    x: 100,
                    y: 100
                };
                
                familyTree.push(newPerson);
            }
            
            closePersonModal();
            renderFamilyTree();
            saveTreeToStorage();
        }
        
        // حذف فرد
        function deletePerson() {
            if (!selectedPersonId) return;
            
            familyTree = familyTree.filter(p => p.id !== selectedPersonId);
            closeConfirmModal();
            renderFamilyTree();
            saveTreeToStorage();
        }
        
        // عرض شجرة العائلة
        function renderFamilyTree() {
            treeContainer.innerHTML = '';
            
            // إضافة الموصلات أولاً (لتكون في الخلفية)
            renderConnectors();
            
            // إضافة الأفراد
            familyTree.forEach(person => {
                const personElement = document.createElement('div');
                personElement.className = `person ${person.gender}`;
                personElement.style.left = `${person.x}px`;
                personElement.style.top = `${person.y}px`;
                personElement.setAttribute('data-id', person.id);
                
                // إضافة قابلية السحب
                makeElementDraggable(personElement, person);
                
                // محتوى العنصر
                personElement.innerHTML = `
                    <div class="person-name">${person.name}</div>
                    <div class="person-dates">
                        ${person.birthDate ? formatDate(person.birthDate) : ''}
                        ${person.deathDate ? ' - ' + formatDate(person.deathDate) : ''}
                    </div>
                `;
                
                // إضافة حدث النقر لعرض خيارات التعديل
                personElement.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showPersonOptions(person.id, personElement);
                });
                
                treeContainer.appendChild(personElement);
            });
        }
        
        // تنسيق التاريخ
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-EG');
        }
        
        // جعل العنصر قابلاً للسحب
        function makeElementDraggable(element, person) {
            let isDragging = false;
            let offsetX, offsetY;
            
            element.addEventListener('mousedown', startDrag);
            
            function startDrag(e) {
                isDragging = true;
                offsetX = e.clientX - element.getBoundingClientRect().left;
                offsetY = e.clientY - element.getBoundingClientRect().top;
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                const containerRect = treeContainer.getBoundingClientRect();
                const x = e.clientX - containerRect.left - offsetX;
                const y = e.clientY - containerRect.top - offsetY;
                
                // التأكد من بقاء العنصر داخل الحاوية
                if (x >= 0 && x <= containerRect.width - element.offsetWidth &&
                    y >= 0 && y <= containerRect.height - element.offsetHeight) {
                    
                    element.style.left = `${x}px`;
                    element.style.top = `${y}px`;
                    
                    // تحديث موقع الشخص في البيانات
                    person.x = x;
                    person.y = y;
                }
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
                
                // حفظ التغييرات
                saveTreeToStorage();
            }
        }
        
        // عرض خيارات الفرد
        function showPersonOptions(personId, element) {
            // إزالة أي قوائم موجودة مسبقًا
            const existingMenu = document.querySelector('.person-options');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            // إنشاء قائمة الخيارات
            const optionsMenu = document.createElement('div');
            optionsMenu.className = 'person-options';
            optionsMenu.style.position = 'absolute';
            optionsMenu.style.left = `${element.offsetLeft + element.offsetWidth}px`;
            optionsMenu.style.top = `${element.offsetTop}px`;
            
            optionsMenu.innerHTML = `
                <div class="option" data-action="edit">تعديل</div>
                <div class="option" data-action="delete" style="color: #dc3545;">حذف</div>
            `;
            
            treeContainer.appendChild(optionsMenu);
            
            // إضافة مستمعي الأحداث للخيارات
            optionsMenu.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    
                    if (action === 'edit') {
                        openEditPersonModal(personId);
                    } else if (action === 'delete') {
                        openConfirmModal(personId);
                    }
                    
                    optionsMenu.remove();
                });
            });
            
            // إغلاق القائمة عند النقر في أي مكان آخر
            document.addEventListener('click', function closeMenu() {
                optionsMenu.remove();
                document.removeEventListener('click', closeMenu);
            });
        }
        
        // رسم الموصلات بين الأفراد
        function renderConnectors() {
            // هذه دالة مبسطة لرسم الموصلات
            // في تطبيق حقيقي، ستحتاج إلى خوارزمية أكثر تعقيدًا لربط الأفراد
            
            // مثال على موصل رأسي
            const verticalConnector = document.createElement('div');
            verticalConnector.className = 'connector vertical';
            verticalConnector.style.left = '50%';
            verticalConnector.style.top = '100px';
            verticalConnector.style.height = '200px';
            treeContainer.appendChild(verticalConnector);
            
            // مثال على موصل أفقي
            const horizontalConnector = document.createElement('div');
            horizontalConnector.className = 'connector horizontal';
            horizontalConnector.style.left = '30%';
            horizontalConnector.style.top = '300px';
            horizontalConnector.style.width = '40%';
            treeContainer.appendChild(horizontalConnector);
        }
        
        // حفظ الشجرة في التخزين المحلي
        function saveTreeToStorage() {
            localStorage.setItem('familyTree', JSON.stringify(familyTree));
            alert('تم حفظ شجرة العائلة بنجاح!');
        }
        
        // تحميل الشجرة من التخزين المحلي
        function loadTreeFromStorage() {
            const savedTree = localStorage.getItem('familyTree');
            if (savedTree) {
                familyTree = JSON.parse(savedTree);
                renderFamilyTree();
                alert('تم تحميل شجرة العائلة بنجاح!');
            } else {
                alert('لا توجد شجرة عائلة محفوظة!');
            }
        }
        
        // إعادة تعيين الشجرة
        function resetTree() {
            if (confirm('هل أنت متأكد من رغبتك في بدء شجرة عائلة جديدة؟ سيتم فقدان جميع البيانات الحالية.')) {
                familyTree = [];
                renderFamilyTree();
                localStorage.removeItem('familyTree');
            }
        }
    </script>
</body>
    </html>
